<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabulator å¤šé ç±¤ Excel åŒ¯å‡º</title>
    
    <!-- Tabulator CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.5.0/css/tabulator.min.css" rel="stylesheet">
    
    <!-- ExcelJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    
    <!-- Tabulator JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.5.0/js/tabulator.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .tabs-container {
            position: relative;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow: hidden;
        }
        
        .tabs-wrapper {
            display: flex;
            align-items: center;
        }
        
        .tabs-nav-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            cursor: pointer;
            font-size: 16px;
            min-width: 50px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border-right: 1px solid #dee2e6;
        }
        
        .tabs-nav-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
            transform: translateY(-1px);
        }
        
        .tabs-nav-btn:disabled {
            background: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
            transform: none;
        }
        
        .tabs-nav-btn.right {
            border-right: none;
            border-left: 1px solid #dee2e6;
        }
        
        .tabs-viewport {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .tabs {
            display: flex;
            transition: transform 0.3s ease;
            width: max-content;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background-color: #e9ecef;
            border: none;
            border-right: 1px solid #dee2e6;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
            flex-shrink: 0;
        }
        
        .tab:hover {
            background-color: #d1ecf1;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 2px solid #007bff;
            color: #007bff;
            font-weight: bold;
        }
        
        .tabs-indicator {
            position: absolute;
            bottom: 0;
            right: 10px;
            background: rgba(0,123,255,0.1);
            color: #007bff;
            padding: 5px 10px;
            border-radius: 10px 10px 0 0;
            font-size: 12px;
            z-index: 10;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .search-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-input {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            min-width: 250px;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .clear-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .clear-btn:hover {
            background: #545b62;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px;
            transition: transform 0.2s ease;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .tabulator {
            margin-top: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        
        /* è‡ªå®šç¾© Tabulator æ¨£å¼ */
        .tabulator .tabulator-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tabulator .tabulator-header .tabulator-col {
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        
        .tabulator .tabulator-header .tabulator-col-title {
            color: white;
            font-weight: bold;
        }
        
        .tabulator .tabulator-header .tabulator-col .tabulator-col-sorter {
            color: white;
        }
        
        .tabulator .tabulator-row:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .tabulator .tabulator-row:hover {
            background-color: #e3f2fd !important;
        }
        
        .high-value {
            background-color: #d4edda !important;
            color: #155724 !important;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .medium-value {
            background-color: #fff3cd !important;
            color: #856404 !important;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .low-value {
            background-color: #f8d7da !important;
            color: #721c24 !important;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        /* åŠŸèƒ½æŒ‰éˆ•æ¨£å¼ */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            align-items: center;
        }
        
        .action-icon {
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .action-icon.enabled:hover {
            background-color: rgba(0,0,0,0.1);
            transform: scale(1.1);
        }
        
        .action-icon.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .permission-icon.unlocked {
            color: #28a745;
        }
        
        .permission-icon.locked {
            color: #dc3545;
        }
        
        .edit-icon.enabled {
            color: #007bff;
        }
        
        .delete-icon.enabled {
            color: #dc3545;
        }
        
        .copy-icon.enabled {
            color: #28a745;
        }
        
        .add-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        
        /* å¤šè¡Œæ–‡å­—æ¨£å¼ */
        .multiline-cell {
            white-space: pre-wrap;
            word-wrap: break-word;
            max-width: 200px;
            line-height: 1.4;
            min-height: 20px;
        }
        
        /* é–å®šæ¬„ä½æ¨£å¼ */
        .locked-cell {
            background-color: #f8f9fa !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
            position: relative;
        }
        
        .locked-cell::before {
            content: "ğŸ”’";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            opacity: 0.6;
        }
        
        /* è‡ªå‹•èª¿æ•´é«˜åº¦çš„è¡¨æ ¼è¡Œ */
        .tabulator .tabulator-row {
            min-height: 40px !important;
        }

        .tabulator .tabulator-cell {
            white-space: pre-wrap !important;
            word-break: break-word !important;
            vertical-align: top !important;
            padding: 8px !important;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                min-width: 100%;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
            }
            
            .action-buttons {
                gap: 4px;
            }
            
            .action-icon {
                font-size: 14px;
                padding: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Tabulator å¤šé ç±¤è³‡æ–™ç®¡ç†ç³»çµ±</h1>
            <p>æ”¯æ´å¤šå·¥ä½œè¡¨ Excel åŒ¯å‡ºã€æœå°‹æ’åºèˆ‡å„²å­˜æ ¼æ¨£å¼è¨­å®š</p>
        </div>
        
        <div class="tabs-container">
            <div class="tabs-wrapper">
                <button class="tabs-nav-btn left" id="tabs-left-btn" onclick="scrollTabs('left')" disabled>
                    â—€
                </button>
                <div class="tabs-viewport" id="tabs-viewport">
                    <div class="tabs" id="tabs-container">
                        <button class="tab active" data-tab="sales" onclick="showTab('sales', this)">éŠ·å”®è³‡æ–™</button>
                        <button class="tab" data-tab="inventory" onclick="showTab('inventory', this)">åº«å­˜è³‡æ–™</button>
                        <button class="tab" data-tab="employees" onclick="showTab('employees', this)">å“¡å·¥è³‡æ–™</button>
                        <button class="tab" data-tab="products" onclick="showTab('products', this)">ç”¢å“è³‡æ–™</button>
                        <button class="tab" data-tab="customers" onclick="showTab('customers', this)">å®¢æˆ¶è³‡æ–™</button>
                        <button class="tab" data-tab="orders" onclick="showTab('orders', this)">è¨‚å–®è³‡æ–™</button>
                        <button class="tab" data-tab="suppliers" onclick="showTab('suppliers', this)">ä¾›æ‡‰å•†è³‡æ–™</button>
                        <button class="tab" data-tab="reports" onclick="showTab('reports', this)">å ±è¡¨åˆ†æ</button>
                        <button class="tab" data-tab="settings" onclick="showTab('settings', this)">ç³»çµ±è¨­å®š</button>
                    </div>
                </div>
                <button class="tabs-nav-btn right" id="tabs-right-btn" onclick="scrollTabs('right')">
                    â–¶
                </button>
            </div>
            <div class="tabs-indicator" id="tabs-indicator">
                1 / 9
            </div>
        </div>
        
        <div id="sales" class="tab-content active">
            <div class="controls">
                <h3>ğŸ›’ éŠ·å”®è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('sales')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="sales-search" class="search-input" placeholder="ğŸ” æœå°‹éŠ·å”®è³‡æ–™..." onkeyup="searchTable('sales', this.value)">
                    <button class="clear-btn" onclick="clearSearch('sales')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="sales-table"></div>
        </div>
        
        <div id="inventory" class="tab-content">
            <div class="controls">
                <h3>ğŸ“¦ åº«å­˜è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('inventory')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="inventory-search" class="search-input" placeholder="ğŸ” æœå°‹åº«å­˜è³‡æ–™..." onkeyup="searchTable('inventory', this.value)">
                    <button class="clear-btn" onclick="clearSearch('inventory')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="inventory-table"></div>
        </div>
        
        <div id="employees" class="tab-content">
            <div class="controls">
                <h3>ğŸ‘¥ å“¡å·¥è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('employees')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="employees-search" class="search-input" placeholder="ğŸ” æœå°‹å“¡å·¥è³‡æ–™..." onkeyup="searchTable('employees', this.value)">
                    <button class="clear-btn" onclick="clearSearch('employees')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="employees-table"></div>
        </div>
        
        <div id="products" class="tab-content">
            <div class="controls">
                <h3>ğŸ“± ç”¢å“è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('products')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="products-search" class="search-input" placeholder="ğŸ” æœå°‹ç”¢å“è³‡æ–™..." onkeyup="searchTable('products', this.value)">
                    <button class="clear-btn" onclick="clearSearch('products')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="products-table"></div>
        </div>
        
        <div id="customers" class="tab-content">
            <div class="controls">
                <h3>ğŸ‘¤ å®¢æˆ¶è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('customers')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="customers-search" class="search-input" placeholder="ğŸ” æœå°‹å®¢æˆ¶è³‡æ–™..." onkeyup="searchTable('customers', this.value)">
                    <button class="clear-btn" onclick="clearSearch('customers')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="customers-table"></div>
        </div>
        
        <div id="orders" class="tab-content">
            <div class="controls">
                <h3>ğŸ“‹ è¨‚å–®è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('orders')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="orders-search" class="search-input" placeholder="ğŸ” æœå°‹è¨‚å–®è³‡æ–™..." onkeyup="searchTable('orders', this.value)">
                    <button class="clear-btn" onclick="clearSearch('orders')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="orders-table"></div>
        </div>
        
        <div id="suppliers" class="tab-content">
            <div class="controls">
                <h3>ğŸ¢ ä¾›æ‡‰å•†è³‡æ–™</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('suppliers')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="suppliers-search" class="search-input" placeholder="ğŸ” æœå°‹ä¾›æ‡‰å•†è³‡æ–™..." onkeyup="searchTable('suppliers', this.value)">
                    <button class="clear-btn" onclick="clearSearch('suppliers')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="suppliers-table"></div>
        </div>
        
        <div id="reports" class="tab-content">
            <div class="controls">
                <h3>ğŸ“Š å ±è¡¨åˆ†æ</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('reports')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="reports-search" class="search-input" placeholder="ğŸ” æœå°‹å ±è¡¨è³‡æ–™..." onkeyup="searchTable('reports', this.value)">
                    <button class="clear-btn" onclick="clearSearch('reports')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="reports-table"></div>
        </div>
        
        <div id="settings" class="tab-content">
            <div class="controls">
                <h3>âš™ï¸ ç³»çµ±è¨­å®š</h3>
                <div class="search-container">
                    <button class="add-btn" onclick="addNewRow('settings')">
                        â• æ–°å¢è³‡æ–™
                    </button>
                    <input type="text" id="settings-search" class="search-input" placeholder="ğŸ” æœå°‹è¨­å®šé …ç›®..." onkeyup="searchTable('settings', this.value)">
                    <button class="clear-btn" onclick="clearSearch('settings')">æ¸…é™¤</button>
                </div>
            </div>
            <div id="settings-table"></div>
        </div>
        
        <button class="export-btn" onclick="exportToExcel()">
            ğŸ“ åŒ¯å‡º Excel æª”æ¡ˆï¼ˆå«æ¨£å¼ï¼‰
        </button>
    </div>

    <script>
        // å„²å­˜æ‰€æœ‰è¡¨æ ¼å¯¦ä¾‹
        let tables = {};
        let currentTabIndex = 0;
        let tabScrollOffset = 0;
        const tabWidth = 120;

        // æ¨¡æ“¬è³‡æ–™ï¼ˆåŠ å…¥é–å®šå’Œå¤šè¡Œå…§å®¹çš„ç¯„ä¾‹ï¼‰
        let salesData = [
            {id: 1, product: "ç­†è¨˜å‹é›»è…¦", category: "3Cç”¢å“", quantity: 25, price: 35000, total: 875000, status: "å·²å®Œæˆ", date: "2024-01-15"},
            {id: 2, product: "æ»‘é¼ ", category: "å‘¨é‚Šè¨­å‚™", quantity: 150, price: 500, total: 75000, status: "ä¸­", date: "2024-02-10"},
            {id: 3, product: "éµç›¤\næ©Ÿæ¢°å¼\né’è»¸", category: "å‘¨é‚Šè¨­å‚™", quantity: 80, price: 1200, total: 96000, status: "ä¸­", date: "2024-02-20"},
            {id: 4, product: "é¡¯ç¤ºå™¨", category: "3Cç”¢å“", quantity: 45, price: 8000, total: 360000, status: "å·²éæœŸ", date: "2024-03-05"},
            {id: 5, product: "å°è¡¨æ©Ÿ\nHP LaserJet\né»‘ç™½åˆ—å°", category: "è¾¦å…¬è¨­å‚™", quantity: 12, price: 3000, total: 36000, status: "ä½", date: "2024-03-15"}
        ];

        let inventoryData = [
            {id: 1, item: "A4 ç´™å¼µ", category: "è¾¦å…¬ç”¨å“", stock: 500, minStock: 100, location: "å€‰åº«A", supplier: "æ–‡å…·å•†è¡Œ\nè¯çµ¡äººï¼šç‹å°æ˜\né›»è©±ï¼š02-1234-5678", status: "å……è¶³"},
            {id: 2, item: "åŸå­ç­†", category: "æ–‡å…·", stock: 80, minStock: 50, location: "å€‰åº«B", supplier: "è¾¦å…¬ç”¨å“åº—", status: "æ­£å¸¸"},
            {id: 3, item: "è³‡æ–™å¤¾", category: "æ–‡å…·", stock: 25, minStock: 30, location: "å€‰åº«A", supplier: "æ–‡å…·å•†è¡Œ", status: "åœç”¨"},
            {id: 4, item: "è¨ˆç®—æ©Ÿ", category: "è¾¦å…¬è¨­å‚™", stock: 200, minStock: 50, location: "å€‰åº«C", supplier: "é›»å­ç”¨å“åº—\nå°ˆæ¥­ç¶­ä¿®\nä¿å›ºä¸€å¹´", status: "å……è¶³"},
            {id: 5, item: "æ©¡çš®æ“¦", category: "æ–‡å…·", stock: 15, minStock: 20, location: "å€‰åº«B", supplier: "æ–‡å…·å•†è¡Œ", status: "ä¸è¶³"}
        ];

        let employeesData = [
            {id: 1, name: "å¼µå°æ˜", department: "è³‡è¨Šéƒ¨", position: "è»Ÿé«”å·¥ç¨‹å¸«\nå…¨ç«¯é–‹ç™¼\nJavaScriptå°ˆå®¶", salary: 55000, performance: "å„ªç§€", joinDate: "2020-03-15", email: "ming@company.com"},
            {id: 2, name: "æç¾éº—", department: "è¡ŒéŠ·éƒ¨", position: "è¡ŒéŠ·å°ˆå“¡", salary: 48000, performance: "å·²éæœŸ", joinDate: "2021-07-20", email: "mei@company.com"},
            {id: 3, name: "ç‹å¤§è¯", department: "è²¡å‹™éƒ¨", position: "æœƒè¨ˆå¸«", salary: 52000, performance: "å„ªç§€", joinDate: "2019-11-10", email: "wang@company.com"},
            {id: 4, name: "é™³å°èŠ±", department: "äººäº‹éƒ¨", position: "äººäº‹å°ˆå“¡\næ‹›å‹Ÿè² è²¬äºº\nç¸¾æ•ˆç®¡ç†", salary: 45000, performance: "åœç”¨", joinDate: "2022-01-08", email: "chen@company.com"},
            {id: 5, name: "æ—å¿—å¼·", department: "æ¥­å‹™éƒ¨", position: "æ¥­å‹™ç¶“ç†", salary: 60000, performance: "è‰¯å¥½", joinDate: "2020-09-12", email: "lin@company.com"}
        ];

        let productsData = [
            {id: 1, name: "MacBook Pro", category: "ç­†è¨˜æœ¬é›»è…¦", price: 55000, stock: 20, status: "ç†±éŠ·"},
            {id: 2, name: "iPhone 15", category: "æ™ºæ…§æ‰‹æ©Ÿ", price: 32000, stock: 50, status: "ç†±éŠ·"},
            {id: 3, name: "iPad Air", category: "å¹³æ¿é›»è…¦", price: 18000, stock: 30, status: "æ™®é€š"},
            {id: 4, name: "AirPods Pro", category: "è€³æ©Ÿ", price: 7500, stock: 100, status: "ç†±éŠ·"},
            {id: 5, name: "Apple Watch", category: "æ™ºæ…§æ‰‹éŒ¶", price: 12000, stock: 25, status: "æ™®é€š"}
        ];

        let customersData = [
            {id: 1, name: "å°ç©é›»", contact: "å¼µç¶“ç†", phone: "02-1234-5678", email: "tsmc@company.com", level: "VIP"},
            {id: 2, name: "é´»æµ·ç§‘æŠ€", contact: "æä¸»ä»»", phone: "03-2345-6789", email: "foxconn@company.com", level: "VIP"},
            {id: 3, name: "è¯ç™¼ç§‘", contact: "ç‹å”ç†", phone: "03-3456-7890", email: "mediatek@company.com", level: "é‡‘ç‰Œ"},
            {id: 4, name: "è¯ç¢©é›»è…¦", contact: "é™³ç¸½ç›£", phone: "02-4567-8901", email: "asus@company.com", level: "é‡‘ç‰Œ"},
            {id: 5, name: "å®ç¢é›†åœ˜", contact: "æ—å‰¯ç¸½", phone: "02-5678-9012", email: "acer@company.com", level: "éŠ€ç‰Œ"}
        ];

        let ordersData = [
            {id: "ORD001", customer: "å°ç©é›»", product: "MacBook Pro", quantity: 10, amount: 550000, status: "å·²å®Œæˆ", date: "2024-05-15"},
            {id: "ORD002", customer: "é´»æµ·ç§‘æŠ€", product: "iPhone 15", quantity: 25, amount: 800000, status: "è™•ç†ä¸­", date: "2024-05-20"},
            {id: "ORD003", customer: "è¯ç™¼ç§‘", product: "iPad Air", quantity: 15, amount: 270000, status: "å·²å®Œæˆ", date: "2024-05-18"},
            {id: "ORD004", customer: "è¯ç¢©é›»è…¦", product: "AirPods Pro", quantity: 50, amount: 375000, status: "å¾…å‡ºè²¨", date: "2024-05-22"},
            {id: "ORD005", customer: "å®ç¢é›†åœ˜", product: "Apple Watch", quantity: 20, amount: 240000, status: "è™•ç†ä¸­", date: "2024-05-25"}
        ];

        let suppliersData = [
            {id: 1, name: "è˜‹æœå°ç£", contact: "ç¾åœ‹ç¸½éƒ¨", phone: "+1-408-996-1010", products: "Appleç”¢å“", rating: "A+"},
            {id: 2, name: "ä¸‰æ˜Ÿé›»å­", contact: "éŸ“åœ‹ç¸½éƒ¨", phone: "+82-2-2255-0114", products: "Androidè¨­å‚™", rating: "A"},
            {id: 3, name: "è¯æƒ³é›†åœ˜", contact: "ä¸­åœ‹ç¸½éƒ¨", phone: "+86-10-5886-8888", products: "ThinkPadç³»åˆ—", rating: "B+"},
            {id: 4, name: "æˆ´çˆ¾ç§‘æŠ€", contact: "ç¾åœ‹ç¸½éƒ¨", phone: "+1-512-338-4400", products: "å•†ç”¨é›»è…¦", rating: "A-"},
            {id: 5, name: "æƒ æ™®ä¼æ¥­", contact: "ç¾åœ‹ç¸½éƒ¨", phone: "+1-650-857-1501", products: "ä¼æ¥­è§£æ±ºæ–¹æ¡ˆ", rating: "B+"}
        ];

        let reportsData = [
            {id: 1, name: "æœˆåº¦éŠ·å”®å ±è¡¨", type: "éŠ·å”®åˆ†æ", lastUpdate: "2024-05-30", status: "æœ€æ–°", size: "2.5MB"},
            {id: 2, name: "åº«å­˜é€±å ±", type: "åº«å­˜ç®¡ç†", lastUpdate: "2024-05-28", status: "æœ€æ–°", size: "1.8MB"},
            {id: 3, name: "å®¢æˆ¶æ»¿æ„åº¦èª¿æŸ¥", type: "å®¢æˆ¶åˆ†æ", lastUpdate: "2024-05-25", status: "éœ€æ›´æ–°", size: "3.2MB"},
            {id: 4, name: "ä¾›æ‡‰å•†ç¸¾æ•ˆè©•ä¼°", type: "ä¾›æ‡‰éˆ", lastUpdate: "2024-05-20", status: "éœ€æ›´æ–°", size: "4.1MB"},
            {id: 5, name: "è²¡å‹™å­£å ±", type: "è²¡å‹™åˆ†æ", lastUpdate: "2024-05-15", status: "å·²éæœŸ", size: "5.6MB"}
        ];

        let settingsData = [
            {id: 1, module: "ä½¿ç”¨è€…ç®¡ç†", setting: "å¯†ç¢¼æ”¿ç­–", value: "8ä½æ•¸+ç‰¹æ®Šå­—å…ƒ", status: "å•Ÿç”¨"},
            {id: 2, module: "ç³»çµ±å®‰å…¨", setting: "ç™»å…¥é€¾æ™‚", value: "30åˆ†é˜", status: "å•Ÿç”¨"},
            {id: 3, module: "è³‡æ–™å‚™ä»½", setting: "è‡ªå‹•å‚™ä»½", value: "æ¯æ—¥å‡Œæ™¨2é»", status: "å•Ÿç”¨"},
            {id: 4, module: "éƒµä»¶é€šçŸ¥", setting: "è¨‚å–®æé†’", value: "å³æ™‚é€šçŸ¥", status: "åœç”¨"},
            {id: 5, module: "å ±è¡¨è¨­å®š", setting: "åŒ¯å‡ºæ ¼å¼", value: "Excel + PDF", status: "å•Ÿç”¨"}
        ];

        // ç²å–è³‡æ–™é™£åˆ—çš„å‡½æ•¸
        function getDataArray(tableName) {
            const dataMap = {
                sales: salesData,
                inventory: inventoryData,
                employees: employeesData,
                products: productsData,
                customers: customersData,
                orders: ordersData,
                suppliers: suppliersData,
                reports: reportsData,
                settings: settingsData
            };
            return dataMap[tableName] || [];
        }

        // æ¨¡æ“¬ API è«‹æ±‚
        async function apiRequest(method, endpoint, data = null) {
            await new Promise(resolve => setTimeout(resolve, 200));
            
            try {
                if (method === 'POST' && data) {
                    const newData = { ...data, id: Date.now() };
                    return { success: true, data: newData };
                } else if (method === 'PUT' && data) {
                    return { success: true, data: data };
                } else if (method === 'DELETE') {
                    return { success: true };
                }
                
                return { success: true, data: null };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // æ¬Šé™æª¢æŸ¥å‡½æ•¸ï¼ˆåŠ å¼·ç‰ˆï¼‰
        function checkPermission(rowData, action) {
            // å®šç¾©å—é™åˆ¶çš„ç‹€æ…‹ï¼ˆé€™äº›ç‹€æ…‹æœƒè¢«é–å®šï¼‰
            const restrictedStatuses = ['å·²å®Œæˆ', 'å·²éæœŸ', 'åœç”¨'];
            const status = rowData.status || rowData.performance || rowData.level;
            
            if (action === 'edit' || action === 'delete') {
                return !restrictedStatuses.includes(status);
            }
            
            return true; // è¤‡è£½åŠŸèƒ½ä¸€èˆ¬éƒ½å…è¨±
        }

        // æª¢æŸ¥ç‰¹å®šæ¬„ä½æ˜¯å¦å¯ç·¨è¼¯
        function isFieldEditable(rowData, fieldName) {
            const restrictedStatuses = ['å·²å®Œæˆ', 'å·²éæœŸ', 'åœç”¨'];
            const status = rowData.status || rowData.performance || rowData.level;
            
            // å¦‚æœæ•´è¡Œéƒ½è¢«é–å®šï¼Œå‰‡æ‰€æœ‰æ¬„ä½éƒ½ä¸å¯ç·¨è¼¯
            if (restrictedStatuses.includes(status)) {
                return false;
            }
            
            // ç‰¹å®šæ¬„ä½çš„é¡å¤–é™åˆ¶ï¼ˆä¾‹å¦‚ï¼šID æ°¸é ä¸å¯ç·¨è¼¯ï¼‰
            const alwaysReadOnlyFields = ['id'];
            if (alwaysReadOnlyFields.includes(fieldName)) {
                return false;
            }
            
            return true;
        }

        // å‰µå»ºåŠŸèƒ½æ¬„ä½
        function createActionColumn(tableName) {
            return {
                title: "åŠŸèƒ½",
                field: "actions",
                width: 200,
                hozAlign: "center",
                headerSort: false,
                cellClick: function(e, cell) {
                    e.stopPropagation();
                },
                formatter: function(cell, formatterParams) {
                    const rowData = cell.getRow().getData();
                    const canEdit = checkPermission(rowData, 'edit');
                    const canDelete = checkPermission(rowData, 'delete');
                    
                    const permissionIcon = (canEdit && canDelete) ? 
                        '<i class="action-icon permission-icon unlocked" title="å¯ç·¨è¼¯">ğŸ”“</i>' : 
                        '<i class="action-icon permission-icon locked" title="åƒ…è®€å–">ğŸ”’</i>';
                    
                    const editIcon = canEdit ? 
                        '<i class="action-icon edit-icon enabled" title="ä¿®æ”¹" onclick="editRow(\'' + tableName + '\', ' + JSON.stringify(rowData.id) + ')">âœï¸</i>' :
                        '<i class="action-icon edit-icon disabled" title="ç„¡æ³•ä¿®æ”¹">âœï¸</i>';
                    
                    const deleteIcon = canDelete ? 
                        '<i class="action-icon delete-icon enabled" title="åˆªé™¤" onclick="deleteRow(\'' + tableName + '\', ' + JSON.stringify(rowData.id) + ')">ğŸ—‘ï¸</i>' :
                        '<i class="action-icon delete-icon disabled" title="ç„¡æ³•åˆªé™¤">ğŸ—‘ï¸</i>';
                    
                    const copyIcon = '<i class="action-icon copy-icon enabled" title="è¤‡è£½" onclick="copyRow(\'' + tableName + '\', ' + JSON.stringify(rowData.id) + ')">ğŸ“‹</i>';
                    
                    return `<div class="action-buttons">
                        ${permissionIcon}
                        ${editIcon}
                        ${deleteIcon}
                        ${copyIcon}
                    </div>`;
                }
            };
        }

        // è‡ªå‹•èª¿æ•´è¡Œé«˜çš„å‡½æ•¸
        function autoResizeRows(table) {
            if (!table) return;
            
            setTimeout(() => {
                const rows = table.getRows();
                rows.forEach(row => {
                    const cells = row.getCells();
                    let maxLines = 1;
                    
                    cells.forEach(cell => {
                        const value = cell.getValue();
                        if (typeof value === 'string' && value.includes('\n')) {
                            const lines = value.split('\n').length;
                            maxLines = Math.max(maxLines, lines);
                        }
                    });
                    
                    // è¨­å®šè¡Œé«˜
                    const minHeight = Math.max(40, maxLines * 20 + 16);
                    const rowElement = row.getElement();
                    if (rowElement) {
                        rowElement.style.height = minHeight + 'px';
                    }
                });
            }, 100);
        }
        function multilineEditor(cell, onRendered, success, cancel, editorParams) {
            const editor = document.createElement("textarea");
            editor.style.padding = "4px";
            editor.style.width = "100%";
            editor.style.height = "80px";
            editor.style.resize = "vertical";
            editor.style.boxSizing = "border-box";
            editor.style.border = "1px solid #ccc";
            editor.style.borderRadius = "3px";
            editor.value = cell.getValue() || "";

            onRendered(function() {
                editor.focus();
                editor.style.height = "80px";
            });

            function successFunc() {
                success(editor.value);
            }

            editor.addEventListener("blur", successFunc);
            editor.addEventListener("keydown", function(e) {
                if (e.keyCode == 13 && e.ctrlKey) {
                    successFunc();
                }
                if (e.keyCode == 27) {
                    cancel();
                }
            });

            return editor;
        }

        // å¤šè¡Œæ–‡å­—æ ¼å¼åŒ–å™¨ï¼ˆåŠ å¼·ç‰ˆï¼‰
        function multilineFormatter(cell, formatterParams) {
            const value = cell.getValue();
            const rowData = cell.getRow().getData();
            const field = cell.getColumn().getField();
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºé–å®šç‹€æ…‹
            if (!isFieldEditable(rowData, field)) {
                cell.getElement().classList.add('locked-cell');
            }
            
            if (typeof value === 'string' && value.includes('\n')) {
                const lines = value.split('\n');
                const lineCount = lines.length;
                
                // è‡ªå‹•èª¿æ•´è¡Œé«˜
                setTimeout(() => {
                    const rowElement = cell.getRow().getElement();
                    const minHeight = Math.max(40, lineCount * 20 + 16);
                    rowElement.style.height = minHeight + 'px';
                }, 10);
                
                return '<div class="multiline-cell">' + value.replace(/\n/g, '<br>') + '</div>';
            }
            return value || '';
        }

        // æ™ºèƒ½ç·¨è¼¯å™¨ï¼ˆæ ¹æ“šå…§å®¹è‡ªå‹•é¸æ“‡ï¼‰
        function smartEditor(cell, onRendered, success, cancel, editorParams) {
            const rowData = cell.getRow().getData();
            const field = cell.getColumn().getField();
            const currentValue = cell.getValue() || "";
            
            // æª¢æŸ¥æ˜¯å¦å¯ç·¨è¼¯
            if (!isFieldEditable(rowData, field)) {
                // é¡¯ç¤ºé–å®šæç¤º
                showMessage('æ­¤æ¬„ä½å·²è¢«é–å®šï¼Œç„¡æ³•ç·¨è¼¯', 'warning');
                cancel();
                return;
            }
            
            // å¦‚æœå…§å®¹åŒ…å«æ›è¡Œç¬¦æˆ–è¶…é30å­—å…ƒï¼Œä½¿ç”¨å¤šè¡Œç·¨è¼¯å™¨
            if (currentValue.includes('\n') || currentValue.length > 30) {
                return multilineEditor(cell, onRendered, success, cancel, editorParams);
            } else {
                // ä½¿ç”¨å–®è¡Œç·¨è¼¯å™¨
                const editor = document.createElement("input");
                editor.setAttribute("type", "text");
                editor.style.padding = "4px";
                editor.style.width = "100%";
                editor.style.boxSizing = "border-box";
                editor.style.border = "1px solid #ccc";
                editor.style.borderRadius = "3px";
                editor.value = currentValue;

                onRendered(function() {
                    editor.focus();
                    editor.select();
                });

                function successFunc() {
                    success(editor.value);
                }

                editor.addEventListener("blur", successFunc);
                editor.addEventListener("keydown", function(e) {
                    if (e.keyCode == 13) {
                        successFunc();
                    }
                    if (e.keyCode == 27) {
                        cancel();
                    }
                });

                return editor;
            }
        }

        // æ–°å¢è³‡æ–™åŠŸèƒ½
        async function addNewRow(tableName) {
            const table = tables[tableName];
            if (!table) return;

            const newData = createDefaultRowData(tableName);
            
            try {
                const result = await apiRequest('POST', '/' + tableName, newData);
                
                if (result.success) {
                    const createdData = result.data;
                    // æ›´æ–°å°æ‡‰çš„è³‡æ–™é™£åˆ—
                    const dataArray = getDataArray(tableName);
                    dataArray.unshift(createdData);
                    
                    table.addData([createdData], true);
                    showMessage('æ–°å¢æˆåŠŸï¼', 'success');
                } else {
                    showMessage('æ–°å¢å¤±æ•—ï¼š' + result.error, 'error');
                }
            } catch (error) {
                console.error('Add row error:', error);
                showMessage('æ–°å¢éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤', 'error');
            }
        }

        // å‰µå»ºé è¨­è³‡æ–™
        function createDefaultRowData(tableName) {
            const dataArray = getDataArray(tableName);
            const getNextId = () => {
                const maxId = Math.max(...dataArray.map(item => typeof item.id === 'number' ? item.id : 0));
                return maxId + 1;
            };

            const defaultData = {
                sales: {
                    id: getNextId(),
                    product: "æ–°ç”¢å“",
                    category: "3Cç”¢å“", 
                    quantity: 1,
                    price: 0,
                    total: 0,
                    status: "ä¸­",
                    date: new Date().toISOString().slice(0, 10)
                },
                inventory: {
                    id: getNextId(),
                    item: "æ–°å“é …",
                    category: "è¾¦å…¬ç”¨å“",
                    stock: 0,
                    minStock: 10,
                    location: "å€‰åº«A",
                    supplier: "ä¾›æ‡‰å•†",
                    status: "æ­£å¸¸"
                },
                employees: {
                    id: getNextId(),
                    name: "æ–°å“¡å·¥",
                    department: "è³‡è¨Šéƒ¨",
                    position: "è·å“¡",
                    salary: 30000,
                    performance: "æ™®é€š",
                    joinDate: new Date().toISOString().slice(0, 10),
                    email: "email@company.com"
                },
                products: {
                    id: getNextId(),
                    name: "æ–°ç”¢å“",
                    category: "é›»å­ç”¢å“",
                    price: 0,
                    stock: 0,
                    status: "æ™®é€š"
                },
                customers: {
                    id: getNextId(),
                    name: "æ–°å®¢æˆ¶",
                    contact: "è¯çµ¡äºº",
                    phone: "é›»è©±è™Ÿç¢¼",
                    email: "email@company.com",
                    level: "éŠ€ç‰Œ"
                },
                orders: {
                    id: "ORD" + Date.now().toString().slice(-6),
                    customer: "å®¢æˆ¶åç¨±",
                    product: "ç”¢å“åç¨±",
                    quantity: 1,
                    amount: 0,
                    status: "è™•ç†ä¸­",
                    date: new Date().toISOString().slice(0, 10)
                },
                suppliers: {
                    id: getNextId(),
                    name: "æ–°ä¾›æ‡‰å•†",
                    contact: "è¯çµ¡è™•",
                    phone: "é›»è©±è™Ÿç¢¼",
                    products: "ç”¢å“èªªæ˜",
                    rating: "B"
                },
                reports: {
                    id: getNextId(),
                    name: "æ–°å ±è¡¨",
                    type: "åˆ†æå ±è¡¨",
                    lastUpdate: new Date().toISOString().slice(0, 10),
                    status: "éœ€æ›´æ–°",
                    size: "0MB"
                },
                settings: {
                    id: getNextId(),
                    module: "æ–°æ¨¡çµ„",
                    setting: "è¨­å®šé …ç›®",
                    value: "è¨­å®šå€¼",
                    status: "åœç”¨"
                }
            };

            return defaultData[tableName] || {};
        }

        // ä¿®æ”¹è³‡æ–™åŠŸèƒ½
        async function editRow(tableName, rowId) {
            const table = tables[tableName];
            if (!table) return;

            const row = table.getRow(rowId);
            const rowData = row.getData();
            
            if (!checkPermission(rowData, 'edit')) {
                showMessage('æ­¤è³‡æ–™ç„¡æ³•ä¿®æ”¹', 'warning');
                return;
            }

            // è®“è©²è¡Œé€²å…¥ç·¨è¼¯æ¨¡å¼
            const cells = row.getCells();
            cells.forEach(cell => {
                const column = cell.getColumn();
                const field = column.getField();
                
                if (field !== 'id' && field !== 'actions') {
                    cell.edit();
                }
            });
        }

        // å„²å­˜ä¿®æ”¹çš„è³‡æ–™
        async function saveRowData(tableName, rowData) {
            try {
                const result = await apiRequest('PUT', '/' + tableName + '/' + rowData.id, rowData);
                
                if (result.success) {
                    // æ›´æ–°å°æ‡‰çš„è³‡æ–™é™£åˆ—
                    const dataArray = getDataArray(tableName);
                    const index = dataArray.findIndex(item => item.id === rowData.id);
                    if (index !== -1) {
                        dataArray[index] = rowData;
                    }
                    
                    showMessage('ä¿®æ”¹æˆåŠŸï¼', 'success');
                    return result.data;
                } else {
                    showMessage('ä¿®æ”¹å¤±æ•—ï¼š' + result.error, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Save row error:', error);
                showMessage('å„²å­˜éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤', 'error');
                return false;
            }
        }

        // åˆªé™¤è³‡æ–™åŠŸèƒ½
        async function deleteRow(tableName, rowId) {
            const table = tables[tableName];
            if (!table) return;

            const row = table.getRow(rowId);
            const rowData = row.getData();
            
            if (!checkPermission(rowData, 'delete')) {
                showMessage('æ­¤è³‡æ–™ç„¡æ³•åˆªé™¤', 'warning');
                return;
            }

            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                return;
            }

            try {
                const result = await apiRequest('DELETE', '/' + tableName + '/' + rowId);
                
                if (result.success) {
                    // å¾è³‡æ–™é™£åˆ—ä¸­ç§»é™¤
                    const dataArray = getDataArray(tableName);
                    const index = dataArray.findIndex(item => item.id === rowId);
                    if (index !== -1) {
                        dataArray.splice(index, 1);
                    }
                    
                    row.delete();
                    showMessage('åˆªé™¤æˆåŠŸï¼', 'success');
                } else {
                    showMessage('åˆªé™¤å¤±æ•—ï¼š' + result.error, 'error');
                }
            } catch (error) {
                console.error('Delete row error:', error);
                showMessage('åˆªé™¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤', 'error');
            }
        }

        // è¤‡è£½è³‡æ–™åŠŸèƒ½
        async function copyRow(tableName, rowId) {
            const table = tables[tableName];
            if (!table) return;

            const row = table.getRow(rowId);
            const originalData = row.getData();
            
            const copiedData = { ...originalData };
            delete copiedData.id;
            
            if (copiedData.name) {
                copiedData.name = copiedData.name + " (å‰¯æœ¬)";
            } else if (copiedData.product) {
                copiedData.product = copiedData.product + " (å‰¯æœ¬)";
            } else if (copiedData.item) {
                copiedData.item = copiedData.item + " (å‰¯æœ¬)";
            }

            try {
                const result = await apiRequest('POST', '/' + tableName, copiedData);
                
                if (result.success) {
                    const createdData = result.data;
                    
                    // æ›´æ–°å°æ‡‰çš„è³‡æ–™é™£åˆ—
                    const dataArray = getDataArray(tableName);
                    dataArray.unshift(createdData);
                    
                    table.addData([createdData], true);
                    showMessage('è¤‡è£½æˆåŠŸï¼', 'success');
                } else {
                    showMessage('è¤‡è£½å¤±æ•—ï¼š' + result.error, 'error');
                }
            } catch (error) {
                console.error('Copy row error:', error);
                showMessage('è¤‡è£½éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤', 'error');
            }
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.textContent = message;
            
            Object.assign(messageDiv.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '12px 20px',
                borderRadius: '5px',
                color: 'white',
                fontWeight: 'bold',
                zIndex: '9999',
                opacity: '0',
                transition: 'opacity 0.3s ease'
            });

            const colors = {
                success: '#28a745',
                error: '#dc3545', 
                warning: '#ffc107',
                info: '#17a2b8'
            };
            messageDiv.style.backgroundColor = colors[type] || colors.info;

            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 100);

            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }

        // åˆå§‹åŒ–è¡¨æ ¼
        function initTables() {
            // éŠ·å”®è¡¨æ ¼
            tables.sales = new Tabulator("#sales-table", {
                data: salesData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const table = cell.getTable();
                    autoResizeRows(table);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "ç”¢å“åç¨±", field: "product", width: 150, sorter: "string", headerFilter: "input", editor: smartEditor, formatter: multilineFormatter},
                    {title: "åˆ†é¡", field: "category", width: 120, sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "3Cç”¢å“", "å‘¨é‚Šè¨­å‚™", "è¾¦å…¬è¨­å‚™"]}, editor: "select", editorParams: {values: ["3Cç”¢å“", "å‘¨é‚Šè¨­å‚™", "è¾¦å…¬è¨­å‚™"]}},
                    {title: "æ•¸é‡", field: "quantity", width: 100, hozAlign: "right", sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "å–®åƒ¹", field: "price", width: 120, hozAlign: "right", formatter: "money", formatterParams: {symbol: "NT$"}, sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "ç¸½é‡‘é¡", field: "total", width: 150, hozAlign: "right", formatter: "money", formatterParams: {symbol: "NT$"}, sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "ç‹€æ…‹", field: "status", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "é«˜", "ä¸­", "ä½", "å·²å®Œæˆ", "å·²éæœŸ"]}, editor: "select", editorParams: {values: ["é«˜", "ä¸­", "ä½", "å·²å®Œæˆ", "å·²éæœŸ"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         const rowData = cell.getRow().getData();
                         let className = "";
                         
                         // æª¢æŸ¥æ˜¯å¦ç‚ºé–å®šç‹€æ…‹
                         if (!isFieldEditable(rowData, 'status')) {
                             cell.getElement().classList.add('locked-cell');
                         }
                         
                         switch(value) {
                             case "é«˜": className = "high-value"; break;
                             case "ä¸­": className = "medium-value"; break;
                             case "ä½": className = "low-value"; break;
                             case "å·²å®Œæˆ": className = "high-value"; break;
                             case "å·²éæœŸ": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    {title: "æ—¥æœŸ", field: "date", width: 120, hozAlign: "center", sorter: "date", headerFilter: "input", editor: "date"},
                    createActionColumn('sales')
                ]
            });

            // åº«å­˜è¡¨æ ¼
            tables.inventory = new Tabulator("#inventory-table", {
                data: inventoryData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('inventory', rowData);
                    // ç·¨è¼¯å¾Œé‡æ–°èª¿æ•´è¡Œé«˜
                    autoResizeRows(tables.inventory);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "å“é …", field: "item", width: 150, sorter: "string", headerFilter: "input", editor: smartEditor, formatter: multilineFormatter},
                    {title: "åˆ†é¡", field: "category", width: 120, sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "è¾¦å…¬ç”¨å“", "æ–‡å…·", "è¾¦å…¬è¨­å‚™"]}, editor: "select", editorParams: {values: ["è¾¦å…¬ç”¨å“", "æ–‡å…·", "è¾¦å…¬è¨­å‚™"]}},
                    {title: "ç¾æœ‰åº«å­˜", field: "stock", width: 120, hozAlign: "right", sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "æœ€ä½åº«å­˜", field: "minStock", width: 120, hozAlign: "right", sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "ä½ç½®", field: "location", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "å€‰åº«A", "å€‰åº«B", "å€‰åº«C"]}, editor: "select", editorParams: {values: ["å€‰åº«A", "å€‰åº«B", "å€‰åº«C"]}},
                    {title: "ä¾›æ‡‰å•†", field: "supplier", width: 140, sorter: "string", headerFilter: "input", editor: smartEditor, formatter: multilineFormatter},
                    {title: "ç‹€æ…‹", field: "status", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "å……è¶³", "æ­£å¸¸", "ä¸è¶³", "åœç”¨"]}, editor: "select", editorParams: {values: ["å……è¶³", "æ­£å¸¸", "ä¸è¶³", "åœç”¨"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         const rowData = cell.getRow().getData();
                         let className = "";
                         
                         // æª¢æŸ¥æ˜¯å¦ç‚ºé–å®šç‹€æ…‹
                         if (!isFieldEditable(rowData, 'status')) {
                             cell.getElement().classList.add('locked-cell');
                         }
                         
                         switch(value) {
                             case "å……è¶³": className = "high-value"; break;
                             case "æ­£å¸¸": className = "medium-value"; break;
                             case "ä¸è¶³": className = "low-value"; break;
                             case "åœç”¨": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    createActionColumn('inventory')
                ]
            });
            
            // å“¡å·¥è¡¨æ ¼
            tables.employees = new Tabulator("#employees-table", {
                data: employeesData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('employees', rowData);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "å§“å", field: "name", width: 120, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "éƒ¨é–€", field: "department", width: 120, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "è³‡è¨Šéƒ¨", "è¡ŒéŠ·éƒ¨", "è²¡å‹™éƒ¨", "äººäº‹éƒ¨", "æ¥­å‹™éƒ¨"]}, editor: "select", editorParams: {values: ["è³‡è¨Šéƒ¨", "è¡ŒéŠ·éƒ¨", "è²¡å‹™éƒ¨", "äººäº‹éƒ¨", "æ¥­å‹™éƒ¨"]}},
                    {title: "è·ä½", field: "position", width: 140, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "è–ªè³‡", field: "salary", width: 120, hozAlign: "right", formatter: "money", formatterParams: {symbol: "NT$"}, sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "ç¸¾æ•ˆ", field: "performance", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "å„ªç§€", "è‰¯å¥½", "æ™®é€š"]}, editor: "select", editorParams: {values: ["å„ªç§€", "è‰¯å¥½", "æ™®é€š"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         switch(value) {
                             case "å„ªç§€": className = "high-value"; break;
                             case "è‰¯å¥½": className = "medium-value"; break;
                             case "æ™®é€š": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    {title: "åˆ°è·æ—¥æœŸ", field: "joinDate", width: 120, hozAlign: "center", sorter: "date", headerFilter: "input", editor: "date"},
                    {title: "Email", field: "email", width: 180, sorter: "string", headerFilter: "input", editor: "input"},
                    createActionColumn('employees')
                ]
            });
            
            // ç”¢å“è¡¨æ ¼
            tables.products = new Tabulator("#products-table", {
                data: productsData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('products', rowData);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "ç”¢å“åç¨±", field: "name", width: 200, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "åˆ†é¡", field: "category", width: 150, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "åƒ¹æ ¼", field: "price", width: 120, hozAlign: "right", formatter: "money", formatterParams: {symbol: "NT$"}, sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "åº«å­˜", field: "stock", width: 100, hozAlign: "right", sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "ç‹€æ…‹", field: "status", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "ç†±éŠ·", "æ™®é€š", "æ»¯éŠ·"]}, editor: "select", editorParams: {values: ["ç†±éŠ·", "æ™®é€š", "æ»¯éŠ·"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         switch(value) {
                             case "ç†±éŠ·": className = "high-value"; break;
                             case "æ™®é€š": className = "medium-value"; break;
                             case "æ»¯éŠ·": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    createActionColumn('products')
                ]
            });
            
            // å®¢æˆ¶è¡¨æ ¼
            tables.customers = new Tabulator("#customers-table", {
                data: customersData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('customers', rowData);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "å…¬å¸åç¨±", field: "name", width: 180, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "è¯çµ¡äºº", field: "contact", width: 120, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "é›»è©±", field: "phone", width: 140, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "Email", field: "email", width: 200, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "ç­‰ç´š", field: "level", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "VIP", "é‡‘ç‰Œ", "éŠ€ç‰Œ"]}, editor: "select", editorParams: {values: ["VIP", "é‡‘ç‰Œ", "éŠ€ç‰Œ"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         switch(value) {
                             case "VIP": className = "high-value"; break;
                             case "é‡‘ç‰Œ": className = "medium-value"; break;
                             case "éŠ€ç‰Œ": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    createActionColumn('customers')
                ]
            });
            
            // è¨‚å–®è¡¨æ ¼
            tables.orders = new Tabulator("#orders-table", {
                data: ordersData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('orders', rowData);
                },
                columns: [
                    {title: "è¨‚å–®è™Ÿ", field: "id", width: 120, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "å®¢æˆ¶", field: "customer", width: 150, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "ç”¢å“", field: "product", width: 150, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "æ•¸é‡", field: "quantity", width: 100, hozAlign: "right", sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "é‡‘é¡", field: "amount", width: 150, hozAlign: "right", formatter: "money", formatterParams: {symbol: "NT$"}, sorter: "number", headerFilter: "number", editor: "number"},
                    {title: "ç‹€æ…‹", field: "status", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "å·²å®Œæˆ", "è™•ç†ä¸­", "å¾…å‡ºè²¨"]}, editor: "select", editorParams: {values: ["å·²å®Œæˆ", "è™•ç†ä¸­", "å¾…å‡ºè²¨"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         switch(value) {
                             case "å·²å®Œæˆ": className = "high-value"; break;
                             case "è™•ç†ä¸­": className = "medium-value"; break;
                             case "å¾…å‡ºè²¨": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    {title: "æ—¥æœŸ", field: "date", width: 120, hozAlign: "center", sorter: "date", headerFilter: "input", editor: "date"},
                    createActionColumn('orders')
                ]
            });
            
            // ä¾›æ‡‰å•†è¡¨æ ¼
            tables.suppliers = new Tabulator("#suppliers-table", {
                data: suppliersData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('suppliers', rowData);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "ä¾›æ‡‰å•†åç¨±", field: "name", width: 180, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "è¯çµ¡è™•", field: "contact", width: 150, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "é›»è©±", field: "phone", width: 180, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "ä¸»è¦ç”¢å“", field: "products", width: 200, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "è©•ç´š", field: "rating", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "A+", "A", "A-", "B+", "B"]}, editor: "select", editorParams: {values: ["A+", "A", "A-", "B+", "B"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         if (value.startsWith("A")) {
                             className = "high-value";
                         } else if (value.startsWith("B")) {
                             className = "medium-value";
                         } else {
                             className = "low-value";
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    createActionColumn('suppliers')
                ]
            });
            
            // å ±è¡¨è¡¨æ ¼
            tables.reports = new Tabulator("#reports-table", {
                data: reportsData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('reports', rowData);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "å ±è¡¨åç¨±", field: "name", width: 200, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "é¡å‹", field: "type", width: 150, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "æœ€å¾Œæ›´æ–°", field: "lastUpdate", width: 120, hozAlign: "center", sorter: "date", headerFilter: "input", editor: "date"},
                    {title: "ç‹€æ…‹", field: "status", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "æœ€æ–°", "éœ€æ›´æ–°", "å·²éæœŸ"]}, editor: "select", editorParams: {values: ["æœ€æ–°", "éœ€æ›´æ–°", "å·²éæœŸ"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         switch(value) {
                             case "æœ€æ–°": className = "high-value"; break;
                             case "éœ€æ›´æ–°": className = "medium-value"; break;
                             case "å·²éæœŸ": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    {title: "æª”æ¡ˆå¤§å°", field: "size", width: 120, hozAlign: "right", sorter: "string", headerFilter: "input", editor: "input"},
                    createActionColumn('reports')
                ]
            });
            
            // è¨­å®šè¡¨æ ¼
            tables.settings = new Tabulator("#settings-table", {
                data: settingsData,
                layout: "fitColumns",
                pagination: "local",
                paginationSize: 10,
                movableColumns: true,
                resizableRows: true,
                cellEdited: function(cell) {
                    const rowData = cell.getRow().getData();
                    saveRowData('settings', rowData);
                },
                columns: [
                    {title: "ID", field: "id", width: 80, hozAlign: "center", sorter: "number", headerFilter: "input"},
                    {title: "åŠŸèƒ½æ¨¡çµ„", field: "module", width: 150, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "è¨­å®šé …ç›®", field: "setting", width: 150, sorter: "string", headerFilter: "input", editor: "input"},
                    {title: "è¨­å®šå€¼", field: "value", width: 200, sorter: "string", headerFilter: "input", editor: multilineEditor, formatter: multilineFormatter},
                    {title: "ç‹€æ…‹", field: "status", width: 100, hozAlign: "center", sorter: "string", headerFilter: "select", headerFilterParams: {values: ["", "å•Ÿç”¨", "åœç”¨"]}, editor: "select", editorParams: {values: ["å•Ÿç”¨", "åœç”¨"]},
                     formatter: function(cell) {
                         const value = cell.getValue();
                         let className = "";
                         switch(value) {
                             case "å•Ÿç”¨": className = "high-value"; break;
                             case "åœç”¨": className = "low-value"; break;
                         }
                         return `<span class="${className}">${value}</span>`;
                     }
                    },
                    createActionColumn('settings')
                ]
            });
        }
        
        // é ç±¤åˆ‡æ›åŠŸèƒ½
        function showTab(tabName, tabElement) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetContent = document.getElementById(tabName);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            if (tabElement) {
                tabElement.classList.add('active');
                
                const tabsContainer = document.getElementById('tabs-container');
                const tabsViewport = document.getElementById('tabs-viewport');
                const tabIndex = Array.from(tabsContainer.children).indexOf(tabElement);
                const tabPosition = tabIndex * tabWidth;
                const viewportWidth = tabsViewport.offsetWidth;
                const containerWidth = tabsContainer.scrollWidth;
                const maxScroll = Math.max(0, containerWidth - viewportWidth);
                
                if (maxScroll > 0) {
                    if (tabPosition < tabScrollOffset || tabPosition + tabWidth > tabScrollOffset + viewportWidth) {
                        tabScrollOffset = Math.max(0, Math.min(maxScroll, tabPosition - viewportWidth / 2 + tabWidth / 2));
                        tabsContainer.style.transform = `translateX(-${tabScrollOffset}px)`;
                        
                        document.getElementById('tabs-left-btn').disabled = tabScrollOffset <= 0;
                        document.getElementById('tabs-right-btn').disabled = tabScrollOffset >= maxScroll;
                        
                        const visibleCount = Math.floor(viewportWidth / tabWidth);
                        const visibleStart = Math.floor(tabScrollOffset / tabWidth) + 1;
                        const visibleEnd = Math.min(9, visibleStart + visibleCount - 1);
                        document.getElementById('tabs-indicator').textContent = `${visibleStart}-${visibleEnd} / 9`;
                    }
                }
            }
            
            if (tables[tabName]) {
                setTimeout(() => {
                    Object.values(tables).forEach(table => autoResizeRows(table));
                }, 500);
            }
        }
        
        // å…¨åŸŸæœå°‹åŠŸèƒ½
        function searchTable(tableName, searchTerm) {
            if (tables[tableName]) {
                if (searchTerm.trim() === "") {
                    tables[tableName].clearFilter();
                } else {
                    let searchFields = [];
                    
                    switch(tableName) {
                        case 'sales':
                            searchFields = ['product', 'category', 'status'];
                            break;
                        case 'inventory':
                            searchFields = ['item', 'category', 'location', 'supplier', 'status'];
                            break;
                        case 'employees':
                            searchFields = ['name', 'department', 'position', 'performance', 'email'];
                            break;
                        case 'products':
                            searchFields = ['name', 'category', 'status'];
                            break;
                        case 'customers':
                            searchFields = ['name', 'contact', 'email', 'level'];
                            break;
                        case 'orders':
                            searchFields = ['id', 'customer', 'product', 'status'];
                            break;
                        case 'suppliers':
                            searchFields = ['name', 'contact', 'products', 'rating'];
                            break;
                        case 'reports':
                            searchFields = ['name', 'type', 'status'];
                            break;
                        case 'settings':
                            searchFields = ['module', 'setting', 'value', 'status'];
                            break;
                        default:
                            searchFields = ['name', 'product', 'item'];
                    }
                    
                    const filters = searchFields.map(field => ({
                        field: field,
                        type: "like",
                        value: searchTerm
                    }));
                    
                    tables[tableName].setFilter([filters]);
                }
            }
        }
        
        // æ¸…é™¤æœå°‹
        function clearSearch(tableName) {
            const searchInput = document.getElementById(tableName + '-search');
            if (searchInput) {
                searchInput.value = "";
            }
            if (tables[tableName]) {
                tables[tableName].clearFilter();
            }
        }
        
        // é ç±¤æ»¾å‹•åŠŸèƒ½
        function scrollTabs(direction) {
            const tabsContainer = document.getElementById('tabs-container');
            const tabsViewport = document.getElementById('tabs-viewport');
            const leftBtn = document.getElementById('tabs-left-btn');
            const rightBtn = document.getElementById('tabs-right-btn');
            const indicator = document.getElementById('tabs-indicator');
            
            const viewportWidth = tabsViewport.offsetWidth;
            const containerWidth = tabsContainer.scrollWidth;
            const maxScroll = Math.max(0, containerWidth - viewportWidth);
            
            if (maxScroll <= 0) {
                return;
            }
            
            const scrollStep = tabWidth * 2;
            
            if (direction === 'left') {
                tabScrollOffset = Math.max(0, tabScrollOffset - scrollStep);
            } else {
                tabScrollOffset = Math.min(maxScroll, tabScrollOffset + scrollStep);
            }
            
            tabsContainer.style.transform = `translateX(-${tabScrollOffset}px)`;
            
            leftBtn.disabled = tabScrollOffset <= 0;
            rightBtn.disabled = tabScrollOffset >= maxScroll;
            
            const visibleCount = Math.floor(viewportWidth / tabWidth);
            const visibleStart = Math.floor(tabScrollOffset / tabWidth) + 1;
            const visibleEnd = Math.min(9, visibleStart + visibleCount - 1);
            indicator.textContent = `${visibleStart}-${visibleEnd} / 9`;
        }
        
        // åŒ¯å‡º Excel åŠŸèƒ½ï¼ˆä½¿ç”¨ ExcelJSï¼‰
        async function exportToExcel() {
            try {
                const workbook = new ExcelJS.Workbook();
                workbook.creator = 'è³‡æ–™ç®¡ç†ç³»çµ±';
                workbook.lastModifiedBy = 'ç³»çµ±ç®¡ç†å“¡';
                workbook.created = new Date();
                workbook.modified = new Date();
                
                await createSalesWorksheet(workbook);
                await createInventoryWorksheet(workbook);
                await createEmployeesWorksheet(workbook);
                await createProductsWorksheet(workbook);
                await createCustomersWorksheet(workbook);
                await createOrdersWorksheet(workbook);
                await createSuppliersWorksheet(workbook);
                await createReportsWorksheet(workbook);
                await createSettingsWorksheet(workbook);
                
                const fileName = `å®Œæ•´è³‡æ–™å ±è¡¨_${new Date().toISOString().slice(0, 10)}.xlsx`;
                
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                alert(`ğŸ‰ Excel æª”æ¡ˆå·²æˆåŠŸåŒ¯å‡ºï¼š${fileName}\n\nâœ… åŒ…å«å®Œæ•´æ¨£å¼è¨­è¨ˆ\nâœ… å¤šå·¥ä½œè¡¨çµæ§‹\nâœ… æ¢ä»¶æ ¼å¼åŒ–\nâœ… å°ˆæ¥­è¡¨æ ¼æ¨£å¼`);
            } catch (e) {
                console.error('åŒ¯å‡ºéŒ¯èª¤:', e);
                alert('åŒ¯å‡ºéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦');
            }
        }
        
        // å‰µå»ºå„å·¥ä½œè¡¨
        async function createSalesWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('éŠ·å”®è³‡æ–™');
            const headers = ['ID', 'ç”¢å“åç¨±', 'åˆ†é¡', 'æ•¸é‡', 'å–®åƒ¹', 'ç¸½é‡‘é¡', 'ç‹€æ…‹', 'æ—¥æœŸ'];
            const columnWidths = [8, 20, 15, 12, 18, 20, 12, 15];
            createWorksheet(worksheet, headers, columnWidths, salesData, 'éŠ·å”®è³‡æ–™å ±è¡¨', 7);
        }
        
        async function createInventoryWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('åº«å­˜è³‡æ–™');
            const headers = ['ID', 'å“é …', 'åˆ†é¡', 'ç¾æœ‰åº«å­˜', 'æœ€ä½åº«å­˜', 'ä½ç½®', 'ä¾›æ‡‰å•†', 'ç‹€æ…‹'];
            const columnWidths = [8, 20, 15, 15, 15, 12, 18, 12];
            createWorksheet(worksheet, headers, columnWidths, inventoryData, 'åº«å­˜ç®¡ç†å ±è¡¨', 8);
        }
        
        async function createEmployeesWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('å“¡å·¥è³‡æ–™');
            const headers = ['ID', 'å§“å', 'éƒ¨é–€', 'è·ä½', 'è–ªè³‡', 'ç¸¾æ•ˆ', 'åˆ°è·æ—¥æœŸ', 'Email'];
            const columnWidths = [8, 15, 15, 18, 18, 12, 15, 28];
            createWorksheet(worksheet, headers, columnWidths, employeesData, 'å“¡å·¥è³‡æ–™çµ±è¨ˆ', 6);
        }
        
        async function createProductsWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('ç”¢å“è³‡æ–™');
            const headers = ['ID', 'ç”¢å“åç¨±', 'åˆ†é¡', 'åƒ¹æ ¼', 'åº«å­˜', 'ç‹€æ…‹'];
            const columnWidths = [8, 20, 18, 18, 12, 12];
            createWorksheet(worksheet, headers, columnWidths, productsData, 'ç”¢å“è³‡æ–™çµ±è¨ˆ', 6);
        }
        
        async function createCustomersWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('å®¢æˆ¶è³‡æ–™');
            const headers = ['ID', 'å…¬å¸åç¨±', 'è¯çµ¡äºº', 'é›»è©±', 'Email', 'ç­‰ç´š'];
            const columnWidths = [8, 20, 15, 18, 25, 12];
            createWorksheet(worksheet, headers, columnWidths, customersData, 'å®¢æˆ¶è³‡æ–™çµ±è¨ˆ', 6);
        }
        
        async function createOrdersWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('è¨‚å–®è³‡æ–™');
            const headers = ['è¨‚å–®è™Ÿ', 'å®¢æˆ¶', 'ç”¢å“', 'æ•¸é‡', 'é‡‘é¡', 'ç‹€æ…‹', 'æ—¥æœŸ'];
            const columnWidths = [15, 18, 18, 12, 20, 12, 15];
            createWorksheet(worksheet, headers, columnWidths, ordersData, 'è¨‚å–®è³‡æ–™çµ±è¨ˆ', 6);
        }
        
        async function createSuppliersWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('ä¾›æ‡‰å•†è³‡æ–™');
            const headers = ['ID', 'ä¾›æ‡‰å•†åç¨±', 'è¯çµ¡è™•', 'é›»è©±', 'ä¸»è¦ç”¢å“', 'è©•ç´š'];
            const columnWidths = [8, 20, 18, 20, 25, 12];
            createWorksheet(worksheet, headers, columnWidths, suppliersData, 'ä¾›æ‡‰å•†è³‡æ–™çµ±è¨ˆ', 6);
        }
        
        async function createReportsWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('å ±è¡¨åˆ†æ');
            const headers = ['ID', 'å ±è¡¨åç¨±', 'é¡å‹', 'æœ€å¾Œæ›´æ–°', 'ç‹€æ…‹', 'æª”æ¡ˆå¤§å°'];
            const columnWidths = [8, 25, 18, 15, 12, 15];
            createWorksheet(worksheet, headers, columnWidths, reportsData, 'å ±è¡¨åˆ†æçµ±è¨ˆ', 5);
        }
        
        async function createSettingsWorksheet(workbook) {
            const worksheet = workbook.addWorksheet('ç³»çµ±è¨­å®š');
            const headers = ['ID', 'åŠŸèƒ½æ¨¡çµ„', 'è¨­å®šé …ç›®', 'è¨­å®šå€¼', 'ç‹€æ…‹'];
            const columnWidths = [8, 18, 18, 25, 12];
            createWorksheet(worksheet, headers, columnWidths, settingsData, 'ç³»çµ±è¨­å®šçµ±è¨ˆ', 5);
        }
        
        // å‰µå»ºå·¥ä½œè¡¨
        function createWorksheet(worksheet, headers, columnWidths, data, title, statusColumn) {
            worksheet.getCell('A1').value = title;
            worksheet.getCell('A1').font = {
                name: 'Microsoft JhengHei',
                size: 16,
                bold: true,
                color: { argb: 'FF4472C4' }
            };
            worksheet.getCell('A1').alignment = {
                horizontal: 'left',
                vertical: 'middle'
            };
            
            for (let i = 0; i < headers.length; i++) {
                worksheet.getColumn(i + 2).width = columnWidths[i];
            }
            
            for (let i = 0; i < headers.length; i++) {
                const cell = worksheet.getCell(2, i + 2);
                cell.value = headers[i];
            }
            
            data.forEach((row, index) => {
                const rowNumber = index + 3;
                const values = Object.values(row);
                for (let i = 0; i < values.length; i++) {
                    const cell = worksheet.getCell(rowNumber, i + 2);
                    let value = values[i];
                    
                    if (typeof value === 'string' && (value.includes('\n') || value.includes('<br>'))) {
                        value = value.replace(/<br\s*\/?>/gi, '\n');
                        cell.value = value;
                        cell.alignment = {
                            wrapText: true,
                            vertical: 'top',
                            horizontal: 'left'
                        };
                        const estimatedLines = (value.match(/\n/g) || []).length + 1;
                        worksheet.getRow(rowNumber).height = Math.max(25, estimatedLines * 15);
                    } else {
                        cell.value = value;
                    }
                }
            });
            
            applyWorksheetStyles(worksheet, headers.length + 1, data.length, statusColumn);
        }
        
        // é€šç”¨æ¨£å¼æ‡‰ç”¨å‡½æ•¸
        function applyWorksheetStyles(worksheet, maxCol, dataLength, statusColumn) {
            const headerRow = worksheet.getRow(2);
            headerRow.height = 30;
            
            for (let col = 2; col <= maxCol; col++) {
                const cell = worksheet.getCell(2, col);
                cell.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FF4472C4' }
                };
                cell.font = {
                    name: 'Microsoft JhengHei',
                    color: { argb: 'FFFFFFFF' },
                    bold: true,
                    size: 12
                };
                cell.alignment = {
                    horizontal: 'center',
                    vertical: 'middle'
                };
                cell.border = {
                    top: { style: 'medium', color: { argb: 'FF2F5597' } },
                    left: { style: 'medium', color: { argb: 'FF2F5597' } },
                    bottom: { style: 'medium', color: { argb: 'FF2F5597' } },
                    right: { style: 'medium', color: { argb: 'FF2F5597' } }
                };
            }
            
            for (let rowNum = 3; rowNum <= dataLength + 2; rowNum++) {
                const row = worksheet.getRow(rowNum);
                row.height = 25;
                
                for (let col = 2; col <= maxCol; col++) {
                    const cell = worksheet.getCell(rowNum, col);
                    
                    cell.font = {
                        name: 'Microsoft JhengHei',
                        size: 11
                    };
                    cell.alignment = {
                        horizontal: 'center',
                        vertical: 'middle'
                    };
                    cell.border = {
                        top: { style: 'thin', color: { argb: 'FFD0D7DE' } },
                        left: { style: 'thin', color: { argb: 'FFD0D7DE' } },
                        bottom: { style: 'thin', color: { argb: 'FFD0D7DE' } },
                        right: { style: 'thin', color: { argb: 'FFD0D7DE' } }
                    };
                    
                    const cellValue = cell.value;
                    if (typeof cellValue === 'number' && cellValue > 1000) {
                        cell.alignment.horizontal = 'right';
                        cell.numFmt = '#,##0';
                    }
                    
                    if (col === statusColumn + 1) {
                        const value = cell.value;
                        let fillColor, fontColor;
                        
                        if (['é«˜', 'å……è¶³', 'å„ªç§€', 'ç†±éŠ·', 'VIP', 'å·²å®Œæˆ', 'A+', 'A', 'æœ€æ–°', 'å•Ÿç”¨'].includes(value)) {
                            fillColor = 'FFC6EFCE';
                            fontColor = 'FF006100';
                        } else if (['ä¸­', 'æ­£å¸¸', 'è‰¯å¥½', 'æ™®é€š', 'é‡‘ç‰Œ', 'è™•ç†ä¸­', 'A-', 'B+', 'éœ€æ›´æ–°'].includes(value)) {
                            fillColor = 'FFFFEB9C';
                            fontColor = 'FF9C5700';
                        } else if (['ä½', 'ä¸è¶³', 'æ»¯éŠ·', 'éŠ€ç‰Œ', 'å¾…å‡ºè²¨', 'B', 'å·²éæœŸ', 'åœç”¨'].includes(value)) {
                            fillColor = 'FFFFC7CE';
                            fontColor = 'FF9C0006';
                        }
                        
                        if (fillColor) {
                            cell.fill = {
                                type: 'pattern',
                                pattern: 'solid',
                                fgColor: { argb: fillColor }
                            };
                            cell.font.color = { argb: fontColor };
                            cell.font.bold = true;
                        }
                    }
                    
                    if (rowNum % 2 === 0 && col !== statusColumn + 1) {
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FFF2F2F2' }
                        };
                    }
                }
            }
        }
        
        // åˆå§‹åŒ–é ç±¤æ»¾å‹•ç‹€æ…‹
        function initTabScrolling() {
            const tabsViewport = document.getElementById('tabs-viewport');
            const tabsContainer = document.getElementById('tabs-container');
            const leftBtn = document.getElementById('tabs-left-btn');
            const rightBtn = document.getElementById('tabs-right-btn');
            const indicator = document.getElementById('tabs-indicator');
            
            tabScrollOffset = 0;
            tabsContainer.style.transform = 'translateX(0px)';
            
            const viewportWidth = tabsViewport.offsetWidth;
            const containerWidth = tabsContainer.scrollWidth;
            const maxScroll = Math.max(0, containerWidth - viewportWidth);
            
            if (maxScroll <= 0) {
                leftBtn.disabled = true;
                rightBtn.disabled = true;
                indicator.textContent = '1-9 / 9';
            } else {
                leftBtn.disabled = true;
                rightBtn.disabled = false;
                const visibleCount = Math.floor(viewportWidth / tabWidth);
                indicator.textContent = `1-${Math.min(visibleCount, 9)} / 9`;
            }
        }
        
        // éŸ¿æ‡‰å¼èª¿æ•´
        function handleResize() {
            setTimeout(() => {
                initTabScrolling();
                
                const activeTab = document.querySelector('.tab.active');
                if (activeTab) {
                    const tabName = activeTab.getAttribute('data-tab');
                    if (tables[tabName]) {
                        tables[tabName].redraw();
                    }
                }
            }, 100);
        }
        
        // éµç›¤å¿«æ·éµæ”¯æ´
        function handleKeyboardShortcuts(event) {
            if (event.ctrlKey) {
                const tabs = document.querySelectorAll('.tab');
                const activeTab = document.querySelector('.tab.active');
                const currentIndex = Array.from(tabs).indexOf(activeTab);
                
                if (event.key === 'ArrowLeft' && currentIndex > 0) {
                    event.preventDefault();
                    const prevTab = tabs[currentIndex - 1];
                    const tabName = prevTab.getAttribute('data-tab');
                    showTab(tabName, prevTab);
                } else if (event.key === 'ArrowRight' && currentIndex < tabs.length - 1) {
                    event.preventDefault();
                    const nextTab = tabs[currentIndex + 1];
                    const tabName = nextTab.getAttribute('data-tab');
                    showTab(tabName, nextTab);
                }
            }
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTables();
            initTabScrolling();
            
            window.addEventListener('resize', handleResize);
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // ç‚ºé ç±¤æ·»åŠ è§¸æ§æ»‘å‹•æ”¯æ´
            let touchStartX = 0;
            let touchEndX = 0;
            
            const tabsViewport = document.getElementById('tabs-viewport');
            
            tabsViewport.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            tabsViewport.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleTabSwipe();
            });
            
            function handleTabSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        scrollTabs('right');
                    } else {
                        scrollTabs('left');
                    }
                }
            }
        });
    </script>
</body>
</html>